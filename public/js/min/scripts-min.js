function checkLoginState(){firebase.auth().onAuthStateChanged(function(e){e?($(".user-info, .new-post-link").show(),$(".login-link").hide(),$(".user-info .avatar").attr("src",e.photoURL),$(".user-info .name").html(e.displayName),$(".user-info .name").html(e.email),$(".user-info, #editor").attr("data-user-email",e.email).attr("data-uid",e.uid).attr("data-uid",e.uid).attr("data-user-display-name",e.displayName),$(".user-info, .tools").removeClass("hide"),$(".new-post").closest("li").removeClass("hide")):($(".new-post-link, .user-info").hide(),$(".user-info .avatar").attr("src",""),$(".user-info .name").html(""),$(".user-info, .tools").addClass("hide"),$(".login").closest("li").removeClass("hide"),$(".new-post").closest("li").removeClass("hide"),$(".login-link").show(),$(".user-info").removeAttr("data-uid").removeAttr("data-user-email").removeAttr("data-user-display-name"))})}function isOwnerOf(e){var t=$(".user-info").data("uid");return e==t}function clearEditor(){$("#editor #id").val(""),$("#editor #title").val(""),$("#editor #content").summernote("reset")}function closeEditor(){$("#editor-modal").modal("hide")}function saveNewPost(e){firebase.database().ref("posts").push(e)}function saveNewComment(e,t){var a={content:$("#comment-input").val(),datetime:Date.now(),username:$(".user-info").data("user-display-name"),uid:e};""!==a.content?firebase.database().ref("posts/"+t+"/comments").push(a):alert("Please enter a comment.")}function allowCommentEdit(){$(".comment").each(function(e,t){var a=$(this).data("comment-uid");isOwnerOf(a)&&$(this).find(".comment-tools").removeClass("hide")})}function updatePost(e,t){firebase.database().ref("posts/"+t).set(e)}function updatePostList(e){var t={posts:e},a=$("#post-list-template").html(),o=Handlebars.compile(a),i=o(t);$("#post-list").html(i),$(".delete-post").click(function(){var e=$(this).closest(".item").data("id");firebase.database().ref("posts/"+e).remove()}),$(".edit-post").click(function(e){var t=$(this).closest(".item").data("id"),a=$(this).closest(".item").find(".title").text(),o=$(this).closest(".item").find(".content").text();$("#editor #id").val(t),$("#editor #title").val(a),$("#editor #content").summernote("editor.insertText",o),$("#editor-modal").modal("show")}),$(".item.post .title").click(function(){var e=$(this).closest(".item").data("id"),t=firebase.database().ref("posts/"+e);t.on("value",function(e){var a=e.val(),o=$("#post-single-template").html(),i=Handlebars.compile(o),n=i(e.val()),s=$(".user-info").data("uid"),r=t.key;$("#post-single-body").html(n),$("#post-modal").modal("show"),$("#post-modal .post").attr("data-id",r),$(".user-info").data("user-display-name")||$("#comment-editor").hide(),$("#submit-comment").click(function(){console.log(r),saveNewComment(s,r)}),$("input[type=text]").on("keydown",function(e){13==e.which&&(e.preventDefault(),saveNewComment(s,r))}),allowCommentEdit(),$(".delete-comment").click(function(e){e.preventDefault();var t=$(this).closest(".comment").data("id"),a=$(this).closest(".post").data("id");firebase.database().ref("posts/"+a+"/comments/"+t).remove()})})}),checkLoginState()}var database=firebase.database(),provider=new firebase.auth.GithubAuthProvider;$(document).ready(function(){Handlebars.registerHelper("length",function(e){var t=$.map(e,function(e,t){return t}).length;return t}),Handlebars.registerHelper("date",function(e){var t=moment(e).format("h:m A D/M/YY");return t}),checkLoginState();var e=firebase.database().ref("posts");e.on("value",function(e){updatePostList(e.val()),allowCommentEdit()}),$("#content").summernote({placeholder:"Write your awesome post here..",height:120,toolbar:[["cleaner",["cleaner"]],["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["media","link","hr"]],["view",["fullscreen","codeview"]]],cleaner:{notTime:2400,action:"paste",notStyle:"position:absolute;top:0;left:0;right:0",keepHtml:!0,keepClasses:!1,badTags:["style","script","applet","embed","noframes","noscript","html"],badAttributes:["style","start"]}}),$(".login").click(function(e){e.preventDefault(),firebase.auth().signInWithPopup(provider).then(function(e){var t=e.credential.accessToken,a=e.user;checkLoginState()}).catch(function(e){var t=e.code,a=e.message,o=e.email,i=e.credential})}),$(".logout").click(function(e){e.preventDefault(),firebase.auth().signOut().then(function(){checkLoginState()},function(e){})}),$("#submit-post").click(function(){var e={title:$("#title").val(),content:$("#content").summernote("code"),datetime:Date.now(),username:$("#editor").data("user-display-name"),uid:$("#editor").data("uid")};if(e.title&&""!==e.content){var t=$("#id").val();t?updatePost(e,t):saveNewPost(e),clearEditor(),closeEditor()}else alert("Please enter a title and some content.")}),$("#cancel-edit-post").click(function(){closeEditor(),clearEditor()})});