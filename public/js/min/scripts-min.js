function checkLoginState(){firebase.auth().onAuthStateChanged(function(e){e?($(".user-info, .new-post-link").show(),$(".login-link").hide(),$(".user-info .avatar").attr("src",e.photoURL),$(".user-info .name").html(e.displayName),$(".user-info .name").html(e.email),$(".user-info, #editor").attr("data-user-email",e.email).attr("data-uid",e.uid).attr("data-uid",e.uid).attr("data-user-display-name",e.displayName),$(".user-info, .tools").removeClass("hide"),$(".new-post").closest("li").removeClass("hide")):($(".new-post-link, .user-info").hide(),$(".user-info .avatar").attr("src",""),$(".user-info .name").html(""),$(".user-info, .tools").addClass("hide"),$(".login").closest("li").removeClass("hide"),$(".new-post").closest("li").removeClass("hide"),$(".login-link").show(),$(".user-info").removeAttr("data-uid").removeAttr("data-user-email").removeAttr("data-user-display-name"),console.log("logged out!"))})}function isOwnerOf(e){var t=$(".user-info").data("uid");return e==t}function clearEditor(){$("#editor #id").val(""),$("#editor #title").val(""),$("#editor #content").summernote("reset")}function closeEditor(){$("#editor-modal").modal("hide")}function saveNewPost(e){firebase.database().ref("posts").push(e)}function saveNewComment(e,t){firebase.database().ref("posts/"+t+"/comments").push(e)}function updatePost(e,t){firebase.database().ref("posts/"+t).set(e)}function updatePostList(e){var t={posts:e},o=$("#post-list-template").html(),a=Handlebars.compile(o),i=a(t);$("#post-list").html(i),$(".delete-post").click(function(){var e=$(this).closest(".item").data("id");firebase.database().ref("posts/"+e).remove()}),$(".edit-post").click(function(e){var t=$(this).closest(".item").data("id"),o=$(this).closest(".item").find(".title").text(),a=$(this).closest(".item").find(".content").text();$("#editor #id").val(t),$("#editor #title").val(o),$("#editor #content").summernote("editor.insertText",a),$("#editor-modal").modal("show")}),$(".item.post .title").click(function(){var e=$(this).closest(".item").data("id"),t=firebase.database().ref("posts/"+e);t.on("value",function(e){var o=e.val(),a=$("#post-single-template").html(),i=Handlebars.compile(a),s=i(e.val()),n=$(".user-info").data("uid");$("#post-single-body").html(s),$("#post-modal").modal("show"),$(".user-info").data("user-display-name")||$("#comment-editor").hide(),$("#submit-comment").click(function(){var e={content:$("#comment-input").val(),datetime:Date.now(),username:$(".user-info").data("user-display-name"),uid:n},o=t.key;n||$("#comment-editor").hide(),""!==e.content?saveNewComment(e,o):console.log("Please enter a comment.")})})})}var database=firebase.database(),provider=new firebase.auth.GithubAuthProvider;$(document).ready(function(){Handlebars.registerHelper("length",function(e){var t=$.map(e,function(e,t){return t}).length;return t}),Handlebars.registerHelper("date",function(e){var t=moment(e).format("h:m A D/M/YY");return t}),checkLoginState();var e=firebase.database().ref("posts");e.on("value",function(e){updatePostList(e.val())}),$("#content").summernote({placeholder:"Write your awesome post here..",height:120,toolbar:[["cleaner",["cleaner"]],["style",["bold","italic","underline","clear"]],["font",["strikethrough"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["media","link","hr"]],["view",["fullscreen","codeview"]]],cleaner:{notTime:2400,action:"both",notStyle:"position:absolute;top:0;left:0;right:0",icon:'<i class="note-icon">[Your Button]</i>',keepHtml:!1,keepClasses:!1,badTags:["style","script","applet","embed","noframes","noscript","html"],badAttributes:["style","start"]}}),$(".login").click(function(e){e.preventDefault(),firebase.auth().signInWithPopup(provider).then(function(e){var t=e.credential.accessToken,o=e.user;checkLoginState()}).catch(function(e){var t=e.code,o=e.message,a=e.email,i=e.credential})}),$(".logout").click(function(e){e.preventDefault(),firebase.auth().signOut().then(function(){checkLoginState()},function(e){})}),$("#submit-post").click(function(){var e={title:$("#title").val(),content:$("#content").summernote("code"),datetime:Date.now(),username:$("#editor").data("user-display-name"),uid:$("#editor").data("uid")};if(e.title&&""!==e.content){var t=$("#id").val();t?updatePost(e,t):saveNewPost(e),clearEditor(),closeEditor()}else console.log("Please enter a title and some content.")}),$("#cancel-edit-post").click(function(){clearEditor(),closeEditor()}),$("#post-modal").on("shown.bs.modal",function(e){postUID=$(this).find(".item").data("post-uid"),console.log(postUID),isOwnerOf(postUID)&&$(this).find(".tools").removeClass("hide")})});